<!DOCTYPE html>
<HTML lang="en">
    <HEAD>
        <META charset="utf-8"/>
        <TITLE>Online Booking System</TITLE>
        <LINK href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"/>
        <LINK href="/style/grid.css" rel="stylesheet"/>
        <SCRIPT type="text/javascript" src="/javascript/bookingAPI.js"></SCRIPT>
        <SCRIPT type="text/javascript">
            window.onload = function() {
                const api = new BookingAPI();
                api.listFlights(function (json) {
                    var table = document.getElementById("flightsTable");
                    var oldTbody = table.tBodies[0];
                    var newTbody = document.createElement("tbody");

                    json.results.forEach(x => {
                        var newRow = newTbody.insertRow(-1);

                        var link = document.createElement('a');
                        link.setAttribute('href', "/info/viewFlight.html?id=" + x.id);
                        link.innerText = x.number;
                        var newCell = newRow.insertCell(0);
                        newCell.appendChild(link);

                        link = document.createElement('a');
                        link.setAttribute('href', "/info/viewAeroplane.html?id=" + x.aeroplane.id);
                        link.innerText = x.aeroplane.make_model;
                        newCell = newRow.insertCell(1);
                        newCell.appendChild(link);

                        newCell = newRow.insertCell(2);
                        // TODO: format departure_time_of_day nicely
                        // TODO: calculate correct timezone
                        var departs = x.departure_airport.name + " " + x.departure_time_of_day;
                        newCell.appendChild(document.createTextNode(departs));

                        newCell = newRow.insertCell(3);
                        // TODO: calculate arrival time, in correct timezone
                        newCell.appendChild(document.createTextNode(x.arrival_airport.name));

                        newCell = newRow.insertCell(4);
                        newCell.appendChild(document.createTextNode(x.flight_time_minutes));

                        newCell = newRow.insertCell(5);
                        var daysOfWeek = "";
                        if (x.departs_sun === true) daysOfWeek += "Sun,"
                        if (x.departs_mon === true) daysOfWeek += "Mon,"
                        if (x.departs_tue === true) daysOfWeek += "Tue,"
                        if (x.departs_wed === true) daysOfWeek += "Wed,"
                        if (x.departs_thu === true) daysOfWeek += "Thu,"
                        if (x.departs_fri === true) daysOfWeek += "Fri,"
                        if (x.departs_sat === true) daysOfWeek += "Sat,"
                        if (daysOfWeek === "Mon,Tue,Wed,Thu,Fri,") {
                            daysOfWeek = "Mon-Fri,"
                        }
                        newCell.appendChild(document.createTextNode(daysOfWeek.slice(0, -1))); // remove trailing ',' character
                    });

                    oldTbody.parentNode.replaceChild(newTbody, oldTbody);
                },
                function(code, json) {
                    var table = document.getElementById("flightsTable");
                    var oldTbody = table.tBodies[0];
                    var newTbody = document.createElement("tbody");

                    var newRow = newTbody.insertRow(-1);
                    var newCell = newRow.insertCell(0);
                    newCell.appendChild(document.createTextNode("code: " + code + ", message: " + json.detail));

                    oldTbody.parentNode.replaceChild(newTbody, oldTbody);
                });
            }
        </SCRIPT>
    </HEAD>
    <BODY>
        <NAV class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
            <DIV class="container-fluid">
                <A class="navbar-brand" href="/">Home</A>
                <BUTTON class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <SPAN class="navbar-toggler-icon"/>
                </BUTTON>
                <DIV class="collapse navbar-collapse" id="navbarCollapse">
                    <UL class="navbar-nav me-auto mb-2 mb-md-0">
                        <LI class="nav-item">
                            <A class="nav-link active" href="/info/listFlights.html">Flights</A>
                        </LI>
                        <LI class="nav-item">
                            <A class="nav-link" href="/info/listAeroplanes.html">Aeroplanes</A>
                        </LI>
                        <LI class="nav-item">
                            <A class="nav-link" href="/user/editUser.html">User</A>
                        </LI>
                        <LI class="nav-item">
                            <A class="nav-link" href="/booking/listBookings.html">Bookings</A>
                        </LI>
                        <LI class="nav-item">
                            <BUTTON class="btn btn-primary" type="button" onclick="window.location.href = '/booking/bookAFlight.html'">Book a flight</BUTTON>
                        </LI>
                    </UL>
                    <FORM class="d-flex">
                        <INPUT class="form-control me-2" type="search" placeholder="Search" aria-label="Search"/>
                        <BUTTON class="btn btn-success" type="submit" onclick="alert('TODO');">Search</BUTTON>
                    </FORM>
                </DIV>
            </DIV>
        </NAV>
        <MAIN class="container">
            <header class="pb-3 mb-5 border-bottom">
                <h1 class="h1 d-flex align-items-center text-dark text-decoration-none">
                    <svg class="bi" width="32" height="32" fill="currentColor">
                        <use xlink:href="/image/bootstrap-icons.svg#calendar3"/>
                    </svg>
                    <span>&nbsp;Book a Flight</span>
                </h1>
            </header>
            <div class="row">
                <div class="col-md-7">
                    <h4 class="mb-3 text-primary">Extras</h4>

                    <nav aria-label="Book a flight pages">
                        <ul class="pagination">
                            <li class="page-item active"><a class="page-link" href="/booking/bookAFlight.html"><span class="badge bg-light text-dark rounded-pill">1</span>&nbsp;Search</a></li>
                            <li class="page-item active"><a class="page-link" href="/booking/selectFlights.html"><span class="badge bg-light text-dark rounded-pill">2</span>&nbsp;Flights</a></li>
                            <li class="page-item active"><a class="page-link" href="/booking/passengerDetails.html"><span class="badge bg-light text-dark rounded-pill">3</span>&nbsp;Passengers</a></li>
                            <li class="page-item active" aria-current="page"><span class="page-link"><span class="badge bg-warning rounded-pill">4</span>&nbsp;Extras</span></li>
                            <li class="page-item disabled"><span class="page-link"><span class="badge bg-secondary rounded-pill">5</span>&nbsp;Seats</span></li>
                            <li class="page-item disabled"><span class="page-link"><span class="badge bg-secondary rounded-pill">6</span>&nbsp;Confirm</span></li>
                            <li class="page-item disabled"><span class="page-link"><span class="badge bg-secondary rounded-pill">7</span>&nbsp;Invoice</span></li>
                        </ul>
                    </nav>

                    <span>TODO: put the extras form here</span>

                    <a class="btn btn-secondary" href="/booking/passengerDetails.html">Previous</a>
                    <a class="btn btn-primary" href="/booking/selectSeats.html">Next</a>
                </div>
                <div class="col-md-5 col-lg-4 order-md-last">
                    <h4 class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-primary">Your Itinerary</span>
                        <span class="badge bg-primary rounded-pill">3</span>
                    </h4>
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">Product name</h6>
                                <small class="text-muted">Brief description</small>
                            </div>
                            <span class="text-muted">$12</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">Second product</h6>
                                <small class="text-muted">Brief description</small>
                            </div>
                            <span class="text-muted">$8</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-sm">
                            <div>
                                <h6 class="my-0">Third item</h6>
                                <small class="text-muted">Brief description</small>
                            </div>
                            <span class="text-muted">$5</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Total (USD)</span>
                            <strong>$20</strong>
                        </li>
                    </ul>
                </div>
            </div>
            <FOOTER class="container">
                <P>Built by Damian Coventry, Copyright &copy; 2022, all rights reserved. &middot; <A href="#">Privacy</A> &middot; <A href="#">Terms</A>
                </P>
                <P>Flight icon created by Freepik &middot; <A href="https://www.flaticon.com/free-icons/plane" title="plane icons">Flaticon</A>
                </P>
            </FOOTER>
        </MAIN>
        <SCRIPT src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
        </SCRIPT>
    </BODY>
</HTML>
