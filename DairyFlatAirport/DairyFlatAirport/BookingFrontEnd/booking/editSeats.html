<!DOCTYPE html>
<HTML lang="en">
    <HEAD>
        <META charset="utf-8"/>
        <TITLE>Online Booking System</TITLE>
        <LINK rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
        <LINK href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
              rel="stylesheet"
              integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
              crossorigin="anonymous"/>

        <SCRIPT>
            window.onload = function () {
                // TODO

                updateSignInGui();
            }

            function updateSignInGui() {
                setSignInButtonText();
                const api = new BookingAPI();
                if (api.isSignedIn()) {
                    signedInUserDisplayName.innerText = api.signedInUserDisplayName;
                    signedInUserSpan.style.display = '';
                    api.getSignedInUser(
                        function (json) {
                            signedInUserDisplayName.innerText = api.signedInUserDisplayName;
                            signedInUserSpan.style.display = '';
                        },
                        showHttpError
                    );
                }
                else {
                    signedInUserDisplayName.innerText = '';
                    signedInUserSpan.style.display = 'none';
                }
            }

            function signInOrOut() {
                const api = new BookingAPI();
                if (api.isSignedIn()) {
                    api.signOut();
                    signedInUserSpan.style.display = 'none';
                }
                else {
                    api.signIn("test test test");
                }
                setSignInButtonText();
            }

            function setSignInButtonText() {
                const api = new BookingAPI();
                if (api.isSignedIn()) {
                    signInOrOutButton.setAttribute('class', 'btn btn-success');
                    signInOrOutButton.innerText = 'Sign Out';
                }
                else {
                    signInOrOutButton.setAttribute('class', 'btn btn-primary');
                    signInOrOutButton.innerText = 'Sign In';
                    signedInUserDisplayName.innerText = '';
                }
            }

            function showHttpError(code, json) {
                errorMessageTitle.innerText = 'Error Received';
                errorMessageBody.innerHTML = 'The server returned HTTP code ' + code + '.<BR><BR>' + javascriptObjectToDivs(json);
                showError();
            }

            function javascriptObjectToDivs(object) {
                let html = '';
                for (var key of Object.keys(object)) {
                    html = '<div class="row"><div class="col">' + key + ': ' + object[key] + '</div></div>\r\n';
                }
                return html;
            }

            function showError() {
                const toastLiveExample = document.getElementById('responseCodePopup');
                const toast = new bootstrap.Toast(toastLiveExample);
                toast.show();
            }
        </SCRIPT>
    </HEAD>
    <BODY>
        <HEADER>
            <NAV class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <DIV class="container-fluid">
                    <A class="navbar-brand"
                       href="/">Home</A>
                    <BUTTON class="navbar-toggler"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#navbarCollapse"
                            aria-controls="navbarCollapse"
                            aria-expanded="false"
                            aria-label="Toggle navigation">
                        <SPAN class="navbar-toggler-icon"/>
                    </BUTTON>
                    <DIV class="collapse navbar-collapse"
                         id="navbarCollapse">
                        <UL class="navbar-nav me-auto mb-2 mb-md-0">
                            <LI class="nav-item">
                                <A class="nav-link"
                                   href="/info/listFlights.html">Flights</A>
                            </LI>
                            <LI class="nav-item">
                                <A class="nav-link"
                                   href="/info/listAeroplanes.html">Aeroplanes</A>
                            </LI>
                            <LI class="nav-item">
                                <A class="nav-link"
                                   href="/user/editUser.html">User</A>
                            </LI>
                            <LI class="nav-item">
                                <A class="nav-link active"
                                   href="/booking/listBookings.html">Bookings</A>
                            </LI>
                            <LI class="nav-item">
                                <BUTTON class="btn btn-success" type="button" onclick="window.location.href = '/booking/bookAFlight.html'">
                                    <i class="fa-solid fa-plane"></i>&nbsp;Book a Flight</BUTTON>
                            </LI>
                        </UL>
                        <div class="d-flex align-items-center">
                            <span id="signedInUserSpan" class="text-light" style="display: none;">Signed in as <span class="text-primary me-3" id="signedInUserDisplayName"></span></span>
                            <button class="btn btn-success" id="signInOrOutButton" onclick="signInOrOut();">Sign In/Out</button>
                        </div>
                    </DIV>
                </DIV>
            </NAV>
        </HEADER>
        <MAIN>
            &nbsp;
        </MAIN>
    </BODY>
</HTML>
